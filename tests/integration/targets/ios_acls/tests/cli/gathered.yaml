---
- ansible.builtin.debug:
    msg: START ios_acls gathered integration tests on connection={{ ansible_connection }}

- ansible.builtin.include_tasks: _remove_config.yaml

- ansible.builtin.include_tasks: _populate_config.yaml

- block:
    - name: Merge tcp/port_protocol configuration
      cisco.ios.ios_acls:
        config:
          - afi: ipv4
            acls:
              - acl_type: extended
                name: ACL_STANDARD_786
                aces:
                  - destination:
                      address: 192.0.2.2
                      wildcard_bits: 0.253.252.252
                      port_protocol:
                        eq: 9422
                    grant: permit
                    protocol: tcp
                    protocol_options:
                      tcp:
                        ack: true
                        fin: true
                    sequence: 30
                    source:
                      address: 192.0.2.1
                      wildcard_bits: 0.251.252.252
                      port_protocol:
                        range:
                          start: "22"
                          end: "23"
          - afi: ipv6
            acls:
              - name: R1_TRAFFIC
                aces:
                  - sequence: 190
                    grant: permit
                    protocol: tcp
                    protocol_options:
                      tcp:
                        ack: true
                        fin: true
                    source:
                      address: 2001:DB8:AB00::/42
                      port_protocol:
                        range:
                          start: "22"
                          end: "23"
                    destination:
                      address: 2001:DB8:AB00::/40
        state: merged

    - name: Gather the provided configuration with the existing running configuration
      register: result
      cisco.ios.ios_acls:
        config:
        state: gathered

    - ansible.builtin.assert:
        that:
          - gathered['config'] | symmetric_difference(result.gathered) == []
          - result['changed'] == false
  always:
    - ansible.builtin.include_tasks: _remove_config.yaml
