---
- name: "Record start time"
  ansible.builtin.command: date +%s.%N
  register: start_time_raw
  delegate_to: localhost
  changed_when: false

- name: "Set start time fact"
  ansible.builtin.set_fact:
    start_time: "{{ start_time_raw.stdout }}"

- name: "Fetch full running-config"
  cisco.ios.ios_command:
    commands:
      - "show running-config"
  register: full_config_output

- name: "Record end time"
  ansible.builtin.command: date +%s.%N
  register: end_time_raw
  delegate_to: localhost
  changed_when: false

- name: "Set end time fact"
  ansible.builtin.set_fact:
    end_time: "{{ end_time_raw.stdout }}"

- name: "Calculate execution time"
  ansible.builtin.set_fact:
    execution_time: "{{ (end_time | float - start_time | float) | round(3) }}"

- name: "Store COMMAND execution time for {{ ansible_network_cli_ssh_type }}"
  ansible.builtin.set_fact:
    "{{ ansible_network_cli_ssh_type }}_command_time": "{{ execution_time }}"